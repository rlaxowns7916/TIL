# CHAR vs VARCHAR

## 1. 기본 정의 및 주요 특성

| 특징                | CHAR                   | VARCHAR                   |
| ----------------- | ---------------------- | ------------------------- |
| **길이**            | 고정 길이                  | 가변 길이                     |
| **패딩**            | 공백으로 패딩됨               | 패딩 없음                     |
| **후행 공백 처리 (검색)** | 기본적으로 제거됨 (RTRIM)      | 보존됨                       |
| **길이 접두사**        | 없음                     | 있음 (1 또는 2 바이트)           |
| **최대 선언 길이 (문자)** | 0~255                 | 0~65,535 (실제 행 크기 제한 고려) |
| **문자셋 영향**        | 강한 영향 (문자당 최대 바이트수 고려) | 강한 영향 (문자당 최대 바이트수 고려)    |

## 2. 저장 메커니즘

### CHAR의 저장 특성
- 저장 시, 최대 길이(M)까지 공백으로 채움 (패딩).
- COMPACT 행 형식에서는 문자셋 고려하여 최소 N 바이트 확보 (in-place Update 여유공간)
  - 딱 맞게 저장했다가 업데이트 시, 기존 Page를 Delete Marking하고 다른 Page에 저장 --> Fragmentation 발생 가능성 있음.
  - Fragmentation 최소화.
- 후행 공백은 검색 시 기본적으로 제거됨(RTRIM), PAD_CHAR_TO_FULL_LENGTH 모드로 변경 가능.

### VARCHAR의 저장 특성
- 실제 데이터 길이 + 길이 접두사(1~2바이트).
- 길이 접두사는 컬럼 정의 시 최대 잠재적 바이트 길이에 따라 결정됨 (255 바이트 기준).
- 후행 공백 보존됨.


## 3. 공간 효율성
* **CHAR:** 고정된 길이로 인해 짧은 데이터에는 공간 낭비 가능성 있음. COMPACT 형식에서는 다중 바이트 문자셋일 경우 일부 최적화됨.
* **VARCHAR:** 실제 데이터 크기에 따라 저장하여 공간 절약. 변동성이 큰 데이터에 유리함.


## 4. 성능 분석

| 성능 측면               | CHAR                                | VARCHAR              |
| ------------------- | ----------------------------------- | -------------------- |
| **읽기 성능 (고정 길이)**   | 약간 더 빠름                             | 약간 느릴 수 있음           |
| **업데이트 (길이 변경 없음)** | 매우 안정적 (내부 업데이트 가능성 높음)             | 안정적                  |
| **업데이트 (약간 길이 증가)** | 미리 확보된 공간으로 내부 업데이트 가능성 높음, 단편화 최소화 | 길이 증가 시 단편화 가능성 있음   |
| **업데이트 (길이 크게 증가)** | N/A (최대 길이 고정됨)                     | 페이지 이동·단편화 발생 가능성 높음 |
| **페이지 단편화 위험**      | 낮음                                  | 높음 (길이 변동 시)         |
| **인덱싱 효율성**         | 우수 (고정 길이로 인덱스 효율적 관리 가능)           | 덜 효율적 (가변 길이 영향)     |


## 5. 문자셋 영향
- **CHAR:** 다중 바이트 문자셋(utf8mb4 등)은 최대 공간 사용량(M × w)을 증가시킴. COMPACT 형식은 최적화로 저장 공간 절약 가능.
- **VARCHAR:** 다중 바이트 문자셋은 최대 길이 제한(65535 바이트) 내에서 선언 가능한 최대 문자 수를 제한함.


## 6. 전략적 선택 가이드

### CHAR 사용이 유리한 경우
- 데이터 길이가 고정되거나 매우 좁은 범위 내에서 자주 변경될 때.
- 잦은 업데이트로 인한 단편화 위험을 최소화해야 할 때.
- 읽기 및 인덱싱 성능이 중요하고 값의 길이가 일관적일 때.

### VARCHAR 사용이 유리한 경우
- 데이터 길이가 크게 변동하고 예측이 어려울 때.
- 저장 공간 효율성이 중요할 때.
- 후행 공백의 보존이 필요할 때.

